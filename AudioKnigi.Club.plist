<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
	<key>WFWorkflowActions</key>
	<array>
		<dict>
			<key>WFWorkflowActionIdentifier</key>
			<string>is.workflow.actions.comment</string>
			<key>WFWorkflowActionParameters</key>
			<dict>
				<key>WFCommentActionText</key>
				<string>Для сохранения аудиокниг с сайта audioknigi.club Важно: нужно перед загрузкой включить переключатель "По главам"

Инструкция по использованию:
1. Рекомендую зайти в iCloud, создать папку для книги (при сохранении можно использовать только ранее созданные папки)
2. В Safari зайти на страницу конкретной книги и включить "По главам" (под списком треков), если выключено. Иначе загрузится только несколько секунд аудио.
3. Нажать поделиться, и выбрать Команды-&gt;AudioBooks.Club
4. Профит (не сворачивайте Safari до завершения загрузки - иначе работа Команды прервётся и нужно будет начинать с начала)

Известные проблемы: 
1. "Истекло время ожидания JavaScript"
Книга закрыта правообладателем; возможно мешает онлайн-радио или другая аудио-активность в другой вкладке.
2. Воспроизведение из iCloud: стандартный плеер не переключается сам между главами и приходится переключать вручную. Решение: использовать Readdle Documents или VLC для воспроизведения аудиокниг из iCloud. Или сохранять через iCloud в Dropbox и воспроизводить через плеер, поддерживающий Dropbox.
P.S. Можно плюсануть мой пулл-реквест в VLC iOS (https://github.com/videolan/vlc-ios/pull/160), чтобы VLC открывал сразу всю папку с аудиокнигой.

Source: https://github.com/Akhrameev/AudioknigiClubSiriShortcut
</string>
			</dict>
		</dict>
		<dict>
			<key>WFWorkflowActionIdentifier</key>
			<string>is.workflow.actions.runjavascriptonwebpage</string>
			<key>WFWorkflowActionParameters</key>
			<dict>
				<key>UUID</key>
				<string>DF4FCE25-CA25-4744-9616-9E81899334BD</string>
				<key>WFJavaScript</key>
				<string>var result = [];

var player = document.getElementsByClassName("jp-jplayer")[0];
var playlistItems = document.getElementsByClassName("jp-playlist-item");

for (let item of playlistItems) {
  item.click();

  var audio = player.getElementsByTagName("audio")[0];

  result.push({"title": audio.title, "url":audio.src});
}

document.getElementsByClassName("jp-pause")[0].click();

// Call completion to finish
completion(JSON.stringify(result));</string>
			</dict>
		</dict>
		<dict>
			<key>WFWorkflowActionIdentifier</key>
			<string>is.workflow.actions.detect.dictionary</string>
			<key>WFWorkflowActionParameters</key>
			<dict>
				<key>UUID</key>
				<string>09ECFA0F-F6A5-42A5-A9BD-D09896DAF68C</string>
			</dict>
		</dict>
		<dict>
			<key>WFWorkflowActionIdentifier</key>
			<string>is.workflow.actions.repeat.each</string>
			<key>WFWorkflowActionParameters</key>
			<dict>
				<key>GroupingIdentifier</key>
				<string>0509B251-9294-478E-80DC-24229A565155</string>
				<key>WFControlFlowMode</key>
				<integer>0</integer>
			</dict>
		</dict>
		<dict>
			<key>WFWorkflowActionIdentifier</key>
			<string>is.workflow.actions.getvalueforkey</string>
			<key>WFWorkflowActionParameters</key>
			<dict>
				<key>UUID</key>
				<string>A46D914E-579B-44FE-8595-007960BB6FC4</string>
				<key>WFDictionaryKey</key>
				<string>url</string>
			</dict>
		</dict>
		<dict>
			<key>WFWorkflowActionIdentifier</key>
			<string>is.workflow.actions.downloadurl</string>
			<key>WFWorkflowActionParameters</key>
			<dict>
				<key>Advanced</key>
				<false/>
				<key>UUID</key>
				<string>8E73B594-6A78-48AC-B90B-DD410CB7CB50</string>
			</dict>
		</dict>
		<dict>
			<key>WFWorkflowActionIdentifier</key>
			<string>is.workflow.actions.appendvariable</string>
			<key>WFWorkflowActionParameters</key>
			<dict>
				<key>WFVariableName</key>
				<string>DownloadedFiles</string>
			</dict>
		</dict>
		<dict>
			<key>WFWorkflowActionIdentifier</key>
			<string>is.workflow.actions.repeat.each</string>
			<key>WFWorkflowActionParameters</key>
			<dict>
				<key>GroupingIdentifier</key>
				<string>0509B251-9294-478E-80DC-24229A565155</string>
				<key>UUID</key>
				<string>88EC25A0-87E7-4D32-B8AA-1CE5D467C3BA</string>
				<key>WFControlFlowMode</key>
				<integer>2</integer>
			</dict>
		</dict>
		<dict>
			<key>WFWorkflowActionIdentifier</key>
			<string>is.workflow.actions.getvariable</string>
			<key>WFWorkflowActionParameters</key>
			<dict>
				<key>WFVariable</key>
				<dict>
					<key>Value</key>
					<dict>
						<key>Type</key>
						<string>Variable</string>
						<key>VariableName</key>
						<string>DownloadedFiles</string>
					</dict>
					<key>WFSerializationType</key>
					<string>WFTextTokenAttachment</string>
				</dict>
			</dict>
		</dict>
		<dict>
			<key>WFWorkflowActionIdentifier</key>
			<string>is.workflow.actions.documentpicker.save</string>
			<key>WFWorkflowActionParameters</key>
			<dict>
				<key>UUID</key>
				<string>8B95CECE-4C5A-45F3-ACD4-1538EB1E0B3B</string>
				<key>WFAskWhereToSave</key>
				<true/>
				<key>WFFileDestinationPath</key>
				<string></string>
				<key>WFSaveFileOverwrite</key>
				<false/>
			</dict>
		</dict>
	</array>
	<key>WFWorkflowClientRelease</key>
	<string>2.0</string>
	<key>WFWorkflowClientVersion</key>
	<string>700</string>
	<key>WFWorkflowIcon</key>
	<dict>
		<key>WFWorkflowIconGlyphNumber</key>
		<integer>59753</integer>
		<key>WFWorkflowIconImageData</key>
		<data>
		</data>
		<key>WFWorkflowIconStartColor</key>
		<integer>4292093695</integer>
	</dict>
	<key>WFWorkflowImportQuestions</key>
	<array/>
	<key>WFWorkflowInputContentItemClasses</key>
	<array>
		<string>WFSafariWebPageContentItem</string>
	</array>
	<key>WFWorkflowTypes</key>
	<array>
		<string>WatchKit</string>
		<string>ActionExtension</string>
	</array>
</dict>
</plist>
